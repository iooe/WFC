<Window x:Class="WFC.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:services="clr-namespace:WFC.Services"
        xmlns:local="clr-namespace:WFC"
        mc:Ignorable="d"
        Title="A Hybrid Framework for Procedural Content Generation" Height="800" Width="1200"
        Background="#F5F5F5"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <services:GridSizeConverter x:Key="GridSizeConverter" />
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />

        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Background" Value="#1E88E5" />
            <Setter Property="Foreground" Value="White" />
            <Setter Property="Padding" Value="15,8" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="4"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#1976D2" />
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#1565C0" />
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Background" Value="#BDBDBD" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="SecondaryButton" TargetType="Button">
            <Setter Property="Background" Value="#E0E0E0" />
            <Setter Property="Foreground" Value="#424242" />
            <Setter Property="Padding" Value="15,8" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="4"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#BDBDBD" />
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#9E9E9E" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="RatingButton" TargetType="Button">
            <Setter Property="Background" Value="#E0E0E0" />
            <Setter Property="Foreground" Value="#424242" />
            <Setter Property="Width" Value="30" />
            <Setter Property="Height" Value="30" />
            <Setter Property="Margin" Value="2" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Cursor" Value="Hand" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="15"
                                Padding="0">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#2196F3" />
                    <Setter Property="Foreground" Value="White" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="GroupBoxStyle" TargetType="GroupBox">
            <Setter Property="BorderBrush" Value="#E0E0E0" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Padding" Value="10" />
            <Setter Property="Margin" Value="0,0,0,15" />
            <Setter Property="HeaderTemplate">
                <Setter.Value>
                    <DataTemplate>
                        <TextBlock Text="{Binding}"
                                   FontWeight="SemiBold"
                                   FontSize="14"
                                   Foreground="#424242"
                                   Margin="0,0,0,5" />
                    </DataTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="CheckBoxStyle" TargetType="CheckBox">
            <Setter Property="Margin" Value="0,5" />
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>

        <Style TargetType="TextBox">
            <Setter Property="Padding" Value="8,5" />
            <Setter Property="BorderBrush" Value="#BDBDBD" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Background" Value="White" />
        </Style>

        <Style x:Key="LabelStyle" TargetType="TextBlock">
            <Setter Property="Margin" Value="0,10,0,5" />
            <Setter Property="FontWeight" Value="Normal" />
            <Setter Property="FontSize" Value="12" />
            <Setter Property="Foreground" Value="#424242" />
        </Style>

        <Style x:Key="ZoomButtonStyle" TargetType="Button">
            <Setter Property="Width" Value="36" />
            <Setter Property="Height" Value="36" />
            <Setter Property="Background" Value="#FFFFFF" />
            <Setter Property="BorderBrush" Value="#E0E0E0" />
            <Setter Property="Foreground" Value="#424242" />
            <Setter Property="FontWeight" Value="Bold" />
            <Setter Property="FontSize" Value="16" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#F5F5F5" />
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="TabControlStyle" TargetType="TabControl">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Padding" Value="0" />
        </Style>

        <Style x:Key="TabItemStyle" TargetType="TabItem">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabItem">
                        <Border Name="Border" Margin="0,0,4,0"
                                BorderThickness="0,0,0,2"
                                BorderBrush="Transparent"
                                Background="Transparent">
                            <ContentPresenter x:Name="ContentSite"
                                              VerticalAlignment="Center"
                                              HorizontalAlignment="Center"
                                              ContentSource="Header"
                                              Margin="10,5" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Border" Property="BorderBrush" Value="#1E88E5" />
                                <Setter Property="Foreground" Value="#1E88E5" />
                                <Setter Property="FontWeight" Value="SemiBold" />
                            </Trigger>
                            <Trigger Property="IsSelected" Value="False">
                                <Setter Property="Foreground" Value="#757575" />
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Foreground" Value="#1E88E5" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="PluginCardStyle" TargetType="Border">
            <Setter Property="Background" Value="White" />
            <Setter Property="BorderBrush" Value="#E0E0E0" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="4" />
            <Setter Property="Margin" Value="0,0,0,8" />
            <Setter Property="Padding" Value="10" />
        </Style>
    </Window.Resources>

    <Grid>
        <!-- Top bar -->
        <Border Background="#2196F3" Height="50" VerticalAlignment="Top"
                Panel.ZIndex="100">
            <Grid>
                <TextBlock Text="A Hybrid Framework for Procedural Content Generation"
                           VerticalAlignment="Center"
                           Margin="20,0"
                           Foreground="White"
                           FontSize="20"
                           FontWeight="SemiBold" />

                <Button Style="{StaticResource PrimaryButton}"
                        Content="Generate"
                        Command="{Binding GenerateCommand}"
                        ToolTip="Start the WFC generation process"
                        HorizontalAlignment="Right"
                        Margin="0,0,20,0"
                        Width="120"
                        Height="36" />
            </Grid>
        </Border>

        <!-- Main content -->
        <Grid Margin="0,50,0,30">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="350" />
            </Grid.ColumnDefinitions>

            <!-- Grid view area -->
            <Grid Grid.Column="0" Name="GridContainer">
                <Border Background="White"
                        BorderBrush="#E0E0E0"
                        BorderThickness="1"
                        Margin="15,15,10,15">
                    <Grid>
                        <ScrollViewer Name="MapScrollViewer"
                                      HorizontalScrollBarVisibility="Auto"
                                      VerticalScrollBarVisibility="Auto"
                                      PreviewMouseWheel="MapScrollViewer_PreviewMouseWheel"
                                      PreviewMouseDown="MapScrollViewer_PreviewMouseDown"
                                      PreviewMouseMove="MapScrollViewer_PreviewMouseMove"
                                      PreviewMouseUp="MapScrollViewer_PreviewMouseUp">
                            <!-- Zoomable container -->
                            <Grid Name="ZoomableGrid">
                                <Grid.LayoutTransform>
                                    <ScaleTransform x:Name="ZoomTransform"
                                                    ScaleX="{Binding ZoomLevel}"
                                                    ScaleY="{Binding ZoomLevel}" />
                                </Grid.LayoutTransform>

                                <!-- Map content -->
                                <Canvas Name="TilesCanvas"
                                        Width="{Binding GridWidth, Converter={StaticResource GridSizeConverter}}"
                                        Height="{Binding GridHeight, Converter={StaticResource GridSizeConverter}}">
                                    <ItemsControl ItemsSource="{Binding GridTiles}">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <Canvas />
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemContainerStyle>
                                            <Style TargetType="ContentPresenter">
                                                <Setter Property="Canvas.Left" Value="{Binding X}" />
                                                <Setter Property="Canvas.Top" Value="{Binding Y}" />
                                            </Style>
                                        </ItemsControl.ItemContainerStyle>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Image Source="{Binding Image}"
                                                       Width="100"
                                                       Height="100"
                                                       RenderOptions.BitmapScalingMode="NearestNeighbor" />
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </Canvas>
                            </Grid>
                        </ScrollViewer>
                        <!-- Bottom info bar -->
                        <Border Background="White" BorderBrush="#E0E0E0" BorderThickness="1"
                                VerticalAlignment="Bottom" HorizontalAlignment="Left"
                                CornerRadius="4" Margin="15,0,0,15"
                                Padding="10,6">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Grid: " VerticalAlignment="Center" Foreground="#616161" FontSize="12" />
                                <TextBlock Text="{Binding GridWidth}" VerticalAlignment="Center" FontWeight="SemiBold"
                                           Foreground="#424242" Margin="2,0" />
                                <TextBlock Text="×" VerticalAlignment="Center" Foreground="#616161" Margin="2,0" />
                                <TextBlock Text="{Binding GridHeight}" VerticalAlignment="Center" FontWeight="SemiBold"
                                           Foreground="#424242" Margin="2,0,10,0" />

                                <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}"
                                           Margin="0,0,10,0" />

                                <TextBlock Text="Seed: " VerticalAlignment="Center" Foreground="#616161" FontSize="12" />
                                <TextBlock Text="{Binding SeedText, TargetNullValue='Random'}"
                                           VerticalAlignment="Center"
                                           FontWeight="SemiBold"
                                           Foreground="#424242"
                                           Margin="2,0,0,0" />
                            </StackPanel>
                        </Border>

                        <!-- Quality info overlay -->
                        <Border Background="White" BorderBrush="#E0E0E0" BorderThickness="1"
                                VerticalAlignment="Bottom" HorizontalAlignment="Right"
                                CornerRadius="4" Margin="0,0,90,15" Padding="10,6"
                                Visibility="{Binding HasQualityAssessment, Converter={StaticResource BooleanToVisibilityConverter}}">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Quality: " VerticalAlignment="Center" Foreground="#616161" FontSize="12" />
                                <TextBlock Text="{Binding QualityScoreDisplay}" VerticalAlignment="Center" FontWeight="SemiBold"
                                           Foreground="#424242" Margin="2,0,0,0" />
                            </StackPanel>
                        </Border>

                        <!-- Zoom controls -->
                        <Border Background="White" BorderBrush="#E0E0E0" BorderThickness="1"
                                VerticalAlignment="Bottom" HorizontalAlignment="Right"
                                CornerRadius="4" Margin="0,0,15,15"
                                Padding="5">
                            <StackPanel Orientation="Horizontal">
                                <Button Content="−"
                                        Style="{StaticResource ZoomButtonStyle}"
                                        Command="{Binding ZoomOutCommand}"
                                        ToolTip="Zoom Out (Ctrl+-)"
                                        Margin="0,0,5,0" />
                                <TextBlock Text="{Binding ZoomPercentage}"
                                           VerticalAlignment="Center"
                                           HorizontalAlignment="Center"
                                           Foreground="#424242"
                                           MinWidth="50"
                                           TextAlignment="Center" />
                                <Button Content="+"
                                        Style="{StaticResource ZoomButtonStyle}"
                                        Command="{Binding ZoomInCommand}"
                                        ToolTip="Zoom In (Ctrl++)"
                                        Margin="5,0,0,0" />
                            </StackPanel>
                        </Border>
                    </Grid>
                </Border>
            </Grid>

            <!-- Sidebar with tabs -->
            <Border Grid.Column="1"
                    Background="White"
                    BorderBrush="#E0E0E0"
                    BorderThickness="1"
                    Margin="10,15,15,15">
                <TabControl Style="{StaticResource TabControlStyle}">
                    <!-- Generation Tab -->
                    <TabItem Header="Generation" Style="{StaticResource TabItemStyle}">
                        <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="15">
                            <StackPanel>
                                <!-- Progress bar -->
                                <ProgressBar Value="{Binding Progress}"
                                             Height="6"
                                             Foreground="#2196F3"
                                             Background="#E0E0E0"
                                             BorderThickness="0"
                                             Margin="0,0,0,10" />
                                <TextBlock Text="{Binding Status}"
                                           HorizontalAlignment="Center"
                                           Margin="0,0,0,15"
                                           Foreground="#616161"
                                           FontSize="12" />

                                <!-- Settings -->
                                <GroupBox Header="Settings" Style="{StaticResource GroupBoxStyle}">
                                    <StackPanel>
                                        <TextBlock Text="Grid Size" Style="{StaticResource LabelStyle}" />
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <TextBox Grid.Column="0"
                                                     Text="{Binding GridWidth, UpdateSourceTrigger=PropertyChanged}"
                                                     ToolTip="Width of the generation grid" />
                                            <TextBlock Grid.Column="1" Text="×"
                                                       VerticalAlignment="Center"
                                                       HorizontalAlignment="Center"
                                                       Margin="10,0"
                                                       FontSize="16" />
                                            <TextBox Grid.Column="2"
                                                     Text="{Binding GridHeight, UpdateSourceTrigger=PropertyChanged}"
                                                     ToolTip="Height of the generation grid" />
                                        </Grid>

                                        <TextBlock Text="Random Seed (optional)" Style="{StaticResource LabelStyle}" />
                                        <TextBox Text="{Binding SeedText, UpdateSourceTrigger=PropertyChanged}"
                                                 ToolTip="Enter a seed value for reproducible generation" />

                                        <CheckBox Content="Enable Debug Render"
                                                  IsChecked="{Binding IsAnimationEnabled}"
                                                  Style="{StaticResource CheckBoxStyle}"
                                                  ToolTip="Show the generation process step by step"
                                                  Margin="0,10,0,0" />
                                    </StackPanel>
                                </GroupBox>

                                <!-- Quality Assessment -->
                                <GroupBox Header="Quality Assessment" Style="{StaticResource GroupBoxStyle}"
                                          Visibility="{Binding HasQualityAssessment, Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <StackPanel>
                                        <TextBlock Text="Quality Score:" Margin="0,0,0,5" Foreground="#616161" />
                                        <Grid>
                                            <ProgressBar Value="{Binding QualityScorePercent, Mode=OneWay}" 
                                                         Maximum="100" Height="10" Margin="0,0,0,5" />
                                            <TextBlock Text="{Binding QualityScoreDisplay}" 
                                                       HorizontalAlignment="Center" FontWeight="SemiBold"
                                                       Foreground="#424242" Margin="0,12,0,0" />
                                        </Grid>
                                        
                                        <!-- Dimensional scores -->
                                        <Grid Margin="0,10,0,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition />
                                                <RowDefinition />
                                                <RowDefinition />
                                            </Grid.RowDefinitions>
                                            
                                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Coherence:" 
                                                      Margin="0,0,10,5" Foreground="#616161" />
                                            <ProgressBar Grid.Row="0" Grid.Column="1" 
                                                        Value="{Binding QualityAssessment.DimensionalScores[Coherence], FallbackValue=0}" 
                                                        Maximum="1.0" Height="8" />
                                            <TextBlock Grid.Row="0" Grid.Column="2" 
                                                       Text="{Binding QualityAssessment.DimensionalScores[Coherence], StringFormat={}{0:0.00}, FallbackValue=0.00}"
                                                       Margin="5,0,0,0" FontSize="10" Width="30" />
                                                       
                                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Aesthetics:" 
                                                      Margin="0,5,10,5" Foreground="#616161" />
                                            <ProgressBar Grid.Row="1" Grid.Column="1" 
                                                        Value="{Binding QualityAssessment.DimensionalScores[Aesthetics], FallbackValue=0}" 
                                                        Maximum="1.0" Height="8" Margin="0,5,0,5" />
                                            <TextBlock Grid.Row="1" Grid.Column="2" 
                                                       Text="{Binding QualityAssessment.DimensionalScores[Aesthetics], StringFormat={}{0:0.00}, FallbackValue=0.00}"
                                                       Margin="5,5,0,5" FontSize="10" Width="30" />
                                                       
                                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Playability:" 
                                                      Margin="0,5,10,0" Foreground="#616161" />
                                            <ProgressBar Grid.Row="2" Grid.Column="1" 
                                                        Value="{Binding QualityAssessment.DimensionalScores[Playability], FallbackValue=0}" 
                                                        Maximum="1.0" Height="8" Margin="0,5,0,0" />
                                            <TextBlock Grid.Row="2" Grid.Column="2" 
                                                       Text="{Binding QualityAssessment.DimensionalScores[Playability], StringFormat={}{0:0.00}, FallbackValue=0.00}"
                                                       Margin="5,5,0,0" FontSize="10" Width="30" />
                                        </Grid>
                                        
                                        <!-- Feedback -->
                                        <ItemsControl ItemsSource="{Binding QualityAssessment.Feedback}" 
                                                      Margin="0,10,0,0">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <TextBlock Text="{Binding}" Foreground="#616161" 
                                                              TextWrapping="Wrap" Margin="0,0,0,5" />
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                        
                                        <!-- User Rating -->
                                        <TextBlock Text="Rate this map:" Margin="0,10,0,5" />
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                            <Button Content="1" Command="{Binding RateMapCommand}" 
                                                    CommandParameter="1" Style="{StaticResource RatingButton}" />
                                            <Button Content="2" Command="{Binding RateMapCommand}" 
                                                    CommandParameter="2" Style="{StaticResource RatingButton}" />
                                            <Button Content="3" Command="{Binding RateMapCommand}" 
                                                    CommandParameter="3" Style="{StaticResource RatingButton}" />
                                            <Button Content="4" Command="{Binding RateMapCommand}" 
                                                    CommandParameter="4" Style="{StaticResource RatingButton}" />
                                            <Button Content="5" Command="{Binding RateMapCommand}" 
                                                    CommandParameter="5" Style="{StaticResource RatingButton}" />
                                        </StackPanel>
                                        
                                        <!-- Training Controls -->
                                        <CheckBox Content="Save for training" 
                                                 IsChecked="{Binding SaveForTraining}" 
                                                 Style="{StaticResource CheckBoxStyle}"
                                                 Margin="0,10,0,0" />
                                                 
                                        <Button Content="Train Quality Model" 
                                                Command="{Binding TrainModelCommand}"
                                                Style="{StaticResource SecondaryButton}"
                                                Margin="0,10,0,0" />
                                                
                                        <TextBlock Text="{Binding TrainingStatus}"
                                                  Foreground="#616161"
                                                  TextWrapping="Wrap" 
                                                  TextAlignment="Center"
                                                  Margin="0,5,0,0"
                                                  Visibility="{Binding IsTraining, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                    </StackPanel>
                                </GroupBox>

                                <!-- Export controls -->
                                <GroupBox Header="Export" Style="{StaticResource GroupBoxStyle}">
                                    <UniformGrid Columns="2">
                                        <Button Content="Export PNG"
                                                Command="{Binding ExportAsPngCommand}"
                                                ToolTip="Save the generated map as a PNG image"
                                                Style="{StaticResource SecondaryButton}"
                                                Margin="0,0,5,0" />

                                        <Button Content="Export Tiles"
                                                Command="{Binding ExportAsTilesCommand}"
                                                ToolTip="Export the generated map as individual tiles"
                                                Style="{StaticResource SecondaryButton}"
                                                Margin="5,0,0,0" />
                                    </UniformGrid>
                                </GroupBox>

                                <!-- Current Generation Information -->
                                <GroupBox Header="Generation Info" Style="{StaticResource GroupBoxStyle}"
                                          Visibility="{Binding HasCompletedGeneration, Converter={StaticResource BooleanToVisibilityConverter}, FallbackValue=Collapsed}">
                                    <StackPanel>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition />
                                                <RowDefinition />
                                            </Grid.RowDefinitions>

                                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Grid Size:" Margin="0,0,10,5"
                                                       Foreground="#616161" />

                                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Seed:" Margin="0,0,10,0"
                                                       Foreground="#616161" />
                                            <TextBlock Grid.Row="1" Grid.Column="1"
                                                       Text="{Binding SeedText, TargetNullValue='Random'}"
                                                       FontWeight="SemiBold" />
                                        </Grid>
                                    </StackPanel>
                                </GroupBox>
                            </StackPanel>
                        </ScrollViewer>
                    </TabItem>

                    <!-- Plugins Tab -->
                    <TabItem Header="Plugins" Style="{StaticResource TabItemStyle}">
                        <DockPanel LastChildFill="True">
                            <!-- Apply button at the bottom -->
                            <Border DockPanel.Dock="Bottom" Padding="15">
                                <Button Content="Apply Changes"
                                        Command="{Binding ApplyPluginChangesCommand}"
                                        Style="{StaticResource PrimaryButton}"
                                        HorizontalAlignment="Right"
                                        Width="120" />
                            </Border>

                            <!-- List of plugins -->
                            <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="15,15,15,0">
                                <ItemsControl ItemsSource="{Binding AvailablePlugins}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Style="{StaticResource PluginCardStyle}">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto" />
                                                        <ColumnDefinition Width="*" />
                                                    </Grid.ColumnDefinitions>

                                                    <!-- Plugin enable/disable checkbox -->
                                                    <CheckBox Grid.Column="0"
                                                              IsChecked="{Binding Enabled, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                              VerticalAlignment="Center"
                                                              Margin="0,0,10,0"
                                                              Checked="CheckBox_CheckedChanged"
                                                              Unchecked="CheckBox_CheckedChanged" />

                                                    <!-- Plugin info -->
                                                    <StackPanel Grid.Column="1">
                                                        <!-- Plugin header -->
                                                        <DockPanel LastChildFill="True">
                                                            <!-- Plugin type -->
                                                            <Border Background="#E3F2FD"
                                                                    CornerRadius="3"
                                                                    Padding="6,2"
                                                                    DockPanel.Dock="Right">
                                                                <TextBlock Text="{Binding PluginType}"
                                                                           FontSize="10"
                                                                           Foreground="#1976D2"
                                                                           FontWeight="SemiBold" />
                                                            </Border>

                                                            <!-- Plugin name -->
                                                            <TextBlock Text="{Binding Name}"
                                                                       FontWeight="SemiBold"
                                                                       Foreground="#424242"
                                                                       VerticalAlignment="Center" />
                                                        </DockPanel>
                                                    </StackPanel>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </DockPanel>
                    </TabItem>

                    <!-- Batch Generation Tab -->
                    <TabItem Header="Batch Generation" Style="{StaticResource TabItemStyle}">
                        <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="15">
                            <StackPanel>
                                <!-- Progress bar -->
                                <ProgressBar Value="{Binding BatchProgress}"
                                             Height="6"
                                             Foreground="#2196F3"
                                             Background="#E0E0E0"
                                             BorderThickness="0"
                                             Margin="0,0,0,10" />
                                <TextBlock Text="{Binding BatchStatus}"
                                           HorizontalAlignment="Center"
                                           Margin="0,0,0,15"
                                           Foreground="#616161"
                                           FontSize="12" />

                                <!-- Batch Generation Parameters -->
                                <GroupBox Header="Batch Generation Parameters" Style="{StaticResource GroupBoxStyle}">
                                    <StackPanel>
                                        <TextBlock Text="Number of Maps" Style="{StaticResource LabelStyle}" />
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>
                                            <TextBox Grid.Column="0"
                                                     Text="{Binding BatchMapCount, UpdateSourceTrigger=PropertyChanged}"
                                                     ToolTip="Number of maps to generate" />
                                            <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="5,0,0,0">
                                                <Button Content="-" Width="30"
                                                        Command="{Binding DecreaseBatchMapCountCommand}" />
                                                <Button Content="+" Width="30"
                                                        Command="{Binding IncreaseBatchMapCountCommand}"
                                                        Margin="5,0,0,0" />
                                            </StackPanel>
                                        </Grid>

                                        <TextBlock Text="Grid Size" Style="{StaticResource LabelStyle}" />
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <TextBox Grid.Column="0"
                                                     Text="{Binding BatchGridWidth, UpdateSourceTrigger=PropertyChanged}"
                                                     ToolTip="Width of the generation grid" />
                                            <TextBlock Grid.Column="1" Text="×"
                                                       VerticalAlignment="Center"
                                                       HorizontalAlignment="Center"
                                                       Margin="10,0"
                                                       FontSize="16" />
                                            <TextBox Grid.Column="2"
                                                     Text="{Binding BatchGridHeight, UpdateSourceTrigger=PropertyChanged}"
                                                     ToolTip="Height of the generation grid" />
                                        </Grid>

                                        <CheckBox Content="Use Fixed Seed"
                                                  IsChecked="{Binding BatchUseSeed}"
                                                  Style="{StaticResource CheckBoxStyle}"
                                                  ToolTip="Use the same seed for all maps"
                                                  Margin="0,10,0,0" />

                                        <TextBlock Text="Seed Value"
                                                   Style="{StaticResource LabelStyle}"
                                                   Visibility="{Binding BatchUseSeed, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                        <TextBox Text="{Binding BatchSeedValue, UpdateSourceTrigger=PropertyChanged}"
                                                 ToolTip="Seed value for generation"
                                                 Visibility="{Binding BatchUseSeed, Converter={StaticResource BooleanToVisibilityConverter}}" />

                                        <TextBlock Text="Export Format" Style="{StaticResource LabelStyle}" />
                                        <ComboBox SelectedIndex="{Binding BatchExportFormat}" Margin="0,0,0,10">
                                            <ComboBoxItem Content="PNG Files" />
                                            <ComboBoxItem Content="Individual Tiles" />
                                            <ComboBoxItem Content="Both PNG and Tiles" />
                                        </ComboBox>
                                    </StackPanel>
                                </GroupBox>

                                <!-- Export path -->
                                <GroupBox Header="Export Settings" Style="{StaticResource GroupBoxStyle}">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>

                                        <TextBox Grid.Column="0"
                                                 Text="{Binding BatchExportPath, UpdateSourceTrigger=PropertyChanged}"
                                                 ToolTip="Path to export generated maps"
                                                 IsReadOnly="True"
                                                 Margin="0,0,5,0" />
                                        <Button Grid.Column="1"
                                                Content="Browse..."
                                                Command="{Binding BrowseBatchExportPathCommand}"
                                                Style="{StaticResource SecondaryButton}"
                                                Padding="10,5" />
                                    </Grid>
                                </GroupBox>

                                <!-- Generate button -->
                                <Button Content="Generate Batch"
                                        Command="{Binding GenerateBatchCommand}"
                                        Style="{StaticResource PrimaryButton}"
                                        HorizontalAlignment="Center"
                                        Margin="0,20,0,0"
                                        Padding="20,10"
                                        Width="200" />

                                <!-- Cancel button -->
                                <Button Content="Cancel Batch Generation"
                                        Command="{Binding CancelBatchCommand}"
                                        Style="{StaticResource SecondaryButton}"
                                        HorizontalAlignment="Center"
                                        Margin="0,10,0,0"
                                        Padding="15,8"
                                        Width="200" />

                                <!-- Results summary - shown after generation -->
                                <GroupBox Header="Generation Results"
                                          Style="{StaticResource GroupBoxStyle}"
                                          Visibility="{Binding HasBatchResults, Converter={StaticResource BooleanToVisibilityConverter}}">
                                    <StackPanel>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition />
                                                <RowDefinition />
                                                <RowDefinition />
                                                <RowDefinition />
                                            </Grid.RowDefinitions>

                                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Total Maps Generated:"
                                                       Margin="0,0,10,5" Foreground="#616161" />
                                            <TextBlock Grid.Row="0" Grid.Column="1"
                                                       Text="{Binding BatchTotalMapsGenerated}" FontWeight="SemiBold" />

                                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Elapsed Time:"
                                                       Margin="0,0,10,5" Foreground="#616161" />
                                            <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding BatchElapsedTime}"
                                                       FontWeight="SemiBold" />

                                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Export Location:"
                                                       Margin="0,0,10,5" Foreground="#616161" />
                                            <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding BatchExportPath}"
                                                       FontWeight="SemiBold" />

                                            <TextBlock Grid.Row="3" Grid.Column="0" Text="Status:" Margin="0,0,10,0"
                                                       Foreground="#616161" />
                                            <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding BatchStatusMessage}"
                                                       FontWeight="SemiBold" />
                                        </Grid>

                                        <Button Content="Open Export Folder"
                                                Command="{Binding OpenBatchExportFolderCommand}"
                                                Style="{StaticResource SecondaryButton}"
                                                HorizontalAlignment="Right"
                                                Margin="0,10,0,0"
                                                Padding="15,8"
                                                Width="150" />
                                    </StackPanel>
                                </GroupBox>
                            </StackPanel>
                        </ScrollViewer>
                    </TabItem>
                </TabControl>
            </Border>
        </Grid>

        <!-- Status bar -->
        <Border Background="#EEEEEE" Height="30" VerticalAlignment="Bottom">
            <TextBlock Text="{Binding Status}"
                       VerticalAlignment="Center"
                       Margin="20,0"
                       Foreground="#424242"
                       FontSize="12" />
        </Border>
    </Grid>
</Window>